<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #4cc9f0;
            --light: #f8f9fa;
            --dark: #212529;
        }
        
        body {
            background-color: #f5f7fb;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .job-posting-container {
            max-width: 1000px;
            margin: 2rem auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        .posting-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 2rem;
        }
        
        .form-section {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid #eaeaea;
            display: none;
        }
        
        .form-section.active {
            display: block;
        }
        
        .section-title {
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--primary);
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 10px;
            font-size: 1.2rem;
        }
        
        .form-label {
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #495057;
        }
        
        .form-control, .form-select {
            padding: 0.75rem;
            border: 1px solid #dce1e6;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 0.2rem rgba(67, 97, 238, 0.25);
        }
        
        .btn-primary {
            background-color: var(--primary);
            border-color: var(--primary);
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            border-radius: 8px;
        }
        
        .btn-primary:hover {
            background-color: var(--secondary);
            border-color: var(--secondary);
        }
        
        .btn-outline-secondary {
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
        }
        
        .preview-card {
            border: 1px solid #eaeaea;
            border-radius: 8px;
            padding: 1.5rem;
            background: #fafbfc;
            margin-top: 1rem;
        }
        
        .preview-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }
        
        .preview-company {
            color: #6c757d;
            margin-bottom: 1rem;
        }
        
        .preview-details {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .preview-detail {
            display: flex;
            align-items: center;
            color: #495057;
        }
        
        .preview-detail i {
            margin-right: 5px;
            color: var(--primary);
        }
        
        .preview-description {
            color: #495057;
            line-height: 1.6;
        }
        
        .tag {
            display: inline-block;
            background: #e9ecef;
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.875rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1055;
        }
        
        .toast {
            width: 350px;
            max-width: 100%;
            font-size: 0.875rem;
            background-color: rgba(255, 255, 255, 0.95);
            background-clip: padding-box;
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            border-radius: 0.375rem;
        }
        
        .toast-success {
            border-left: 4px solid #198754;
        }
        
        .toast-error {
            border-left: 4px solid #dc3545;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1060;
            display: none;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .skill-tag {
            display: inline-flex;
            align-items: center;
            background: #e9ecef;
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.875rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .skill-tag .btn-close {
            font-size: 0.6rem;
            margin-left: 0.5rem;
        }
        
        /* Multi-step progress indicator */
        .progress-container {
            margin-bottom: 2rem;
            padding: 0 2rem;
        }
        
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        
        .step {
            text-align: center;
            flex: 1;
            position: relative;
        }
        
        .step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 15px;
            right: -50%;
            width: 100%;
            height: 2px;
            background-color: #e9ecef;
            z-index: 1;
        }
        
        .step.active:not(:last-child)::after {
            background-color: var(--primary);
        }
        
        .step.completed:not(:last-child)::after {
            background-color: var(--primary);
        }
        
        .step-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 0.5rem;
            position: relative;
            z-index: 2;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .step.active .step-circle {
            background-color: var(--primary);
            color: white;
        }
        
        .step.completed .step-circle {
            background-color: var(--success);
            color: white;
        }
        
        .step-label {
            font-size: 0.875rem;
            color: #6c757d;
        }
        
        .step.active .step-label {
            color: var(--primary);
            font-weight: 500;
        }
        
        .step.completed .step-label {
            color: var(--success);
        }
        
        .progress {
            height: 4px;
        }
        
        .progress-bar {
            background-color: var(--primary);
            transition: width 0.3s ease;
        }
        
        .form-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }
        
        @media (max-width: 768px) {
            .job-posting-container {
                margin: 1rem;
            }
            
            .form-section {
                padding: 1rem;
            }
            
            .posting-header {
                padding: 1.5rem;
            }
            
            .progress-container {
                padding: 0 1rem;
            }
            
            .step-indicator {
                font-size: 0.8rem;
            }
            
            .step:not(:last-child)::after {
                right: -40%;
            }
        }
    </style>
</head>
<body>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container">
        <div id="successToast" class="toast toast-success" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i class="bi bi-check-circle text-success me-2"></i>
                <strong class="me-auto">Success</strong>
                <small>Just now</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body">
                Job posted successfully!
            </div>
        </div>
        <div id="errorToast" class="toast toast-error" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i class="bi bi-exclamation-triangle text-danger me-2"></i>
                <strong class="me-auto">Error</strong>
                <small>Just now</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body">
                Failed to post job. Please try again.
            </div>
        </div>
    </div>

    <!-- Main Content -->
<div class="sticky-top bg-white shadow-sm">
    <div th:replace="ownerheader :: owner-header"></div>
</div>    <div class="container my-4">
    
        <div class="job-posting-container">
            <!-- Header -->
            <div class="posting-header">
                <h1 class="h3 mb-2">Post a New Job</h1>
                <p class="mb-0">Fill in the details below to create your job posting</p>
            </div>

            <!-- Progress Indicator -->
            <div class="progress-container">
                <div class="step-indicator">
                    <div class="step active" id="step1">
                        <div class="step-circle">1</div>
                        <div class="step-label">Job Details</div>
                    </div>
                    <div class="step" id="step2">
                        <div class="step-circle">2</div>
                        <div class="step-label">Requirements</div>
                    </div>
                    <div class="step" id="step3">
                        <div class="step-circle">3</div>
                        <div class="step-label">Compensation</div>
                    </div>
                    <div class="step" id="step4">
                        <div class="step-circle">4</div>
                        <div class="step-label">Application</div>
                    </div>
                    <div class="step" id="step5">
                        <div class="step-circle">5</div>
                        <div class="step-label">Preview</div>
                    </div>
                </div>
                <div class="progress">
                    <div class="progress-bar" id="progressBar" style="width: 20%"></div>
                </div>
            </div>

            <!-- Job Posting Form -->
            <form th:action="@{/owner/job/post}" method="post" id="jobPostingForm">
                <!-- Job Details -->
                <div class="form-section active" id="section1">
                    <h3 class="section-title"><i class="bi bi-briefcase"></i> Job Details</h3>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="jobTitle" class="form-label">Job Title *</label>
                            <input type="text" class="form-control" id="jobTitle" name="jobTitle" placeholder="e.g. Senior Web Developer" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="jobType" class="form-label">Job Type *</label>
                            <select class="form-select" id="jobType" name="jobType" required>
                                <option value="" selected disabled>Select job type</option>
                                <option value="full-time">Full-time</option>
                                <option value="part-time">Part-time</option>
                                <option value="contract">Contract</option>
                                <option value="freelance">Freelance</option>
                                <option value="internship">Internship</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Category Selection - ADDED THIS SECTION -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="categoryId" class="form-label">Job Category *</label>
                            <select class="form-select" id="categoryId" name="categoryId" required>
                                <option value="" selected disabled>Select a category</option>
                                <option th:each="category : ${categories}" 
                                        th:value="${category.id}" 
                                        th:text="${category.catName}">
                                </option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="department" class="form-label">Department</label>
                            <input type="text" class="form-control" id="department" name="department" placeholder="e.g. Engineering">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="location" class="form-label">Location *</label>
                            <input type="text" class="form-control" id="location" name="location" placeholder="e.g. New York, NY" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="jobDescription" class="form-label">Job Description *</label>
                        <textarea class="form-control" id="jobDescription" name="jobDescription" rows="5" placeholder="Describe the role, responsibilities, and requirements..." required></textarea>
                    </div>
                    
                    <div class="form-navigation">
                        <button type="button" class="btn btn-outline-secondary" id="saveDraft">
                            <i class="bi bi-file-earmark me-1"></i> Save as Draft
                        </button>
                        <button type="button" class="btn btn-primary" id="next1">Next <i class="bi bi-arrow-right ms-1"></i></button>
                    </div>
                </div>

                <!-- Company Details -->
                <div class="form-section" id="section2">
                    <h3 class="section-title"><i class="bi bi-building"></i> Company Details</h3>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="companyName" class="form-label">Company Name *</label>
                            <input type="text" class="form-control" id="companyName" th:value="${owner.companyName}" >
                            <input type="hidden" name="companyName" th:value="${owner.companyName}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="companyWebsite" class="form-label">Website</label>
                            <input type="url" class="form-control" id="companyWebsite" name="companyWebsite" placeholder="https://example.com">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="companyDescription" class="form-label">Company Description</label>
                        <textarea class="form-control" id="companyDescription"  th:text="${owner.description}"></textarea>
                        <input type="hidden" name="companyDescription" th:value="${owner.description}">
                    </div>
                    
                    <h3 class="section-title mt-4"><i class="bi bi-list-check"></i> Requirements & Skills</h3>
                    
                    <div class="mb-3">
                        <label class="form-label">Required Skills *</label>
                        <div class="mb-2">
                            <input type="text" class="form-control" id="skillInput" placeholder="Add a skill and press Enter">
                        </div>
                        <div id="skillsContainer" class="d-flex flex-wrap gap-2 mb-2">
                            <!-- Skills will be added here dynamically -->
                        </div>
                        <input type="hidden" id="requiredSkills" name="requiredSkills" required>
                        <div class="form-text">Add skills by typing and pressing Enter. Click the × button to remove a skill.</div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="experienceLevel" class="form-label">Experience Level</label>
                            <select class="form-select" id="experienceLevel" name="experienceLevel">
                                <option value="" selected>Select experience level</option>
                                <option value="intern">Intern</option>
                                <option value="entry">Entry Level</option>
                                <option value="mid">Mid Level</option>
                                <option value="senior">Senior Level</option>
                                <option value="lead">Lead</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="educationLevel" class="form-label">Education Level</label>
                            <select class="form-select" id="educationLevel" name="educationLevel">
                                <option value="" selected>Select education level</option>
                                <option value="high-school">High School</option>
                                <option value="associate">Associate Degree</option>
                                <option value="bachelor">Bachelor's Degree</option>
                                <option value="master">Master's Degree</option>
                                <option value="phd">PhD</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-navigation">
                        <button type="button" class="btn btn-outline-secondary" id="prev2">
                            <i class="bi bi-arrow-left me-1"></i> Previous
                        </button>
                        <button type="button" class="btn btn-primary" id="next2">Next <i class="bi bi-arrow-right ms-1"></i></button>
                    </div>
                </div>

                <!-- Compensation & Benefits -->
                <div class="form-section" id="section3">
                    <h3 class="section-title"><i class="bi bi-currency-dollar"></i> Compensation & Benefits</h3>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="salaryMin" class="form-label">Salary Range (Min)</label>
                            <div class="input-group">
                                <span class="input-group-text">MMK</span>
                                <input type="number" class="form-control" id="salaryMin" name="salaryMin" placeholder="e.g. 50000" min="0">
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="salaryMax" class="form-label">Salary Range (Max)</label>
                            <div class="input-group">
                                <span class="input-group-text">MMK</span>
                                <input type="number" class="form-control" id="salaryMax" name="salaryMax" placeholder="e.g. 80000" min="0">
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Benefits</label>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check mb-2">
                                    <input class="form-check-input benefit-checkbox" type="checkbox" id="healthInsurance" value="Health Insurance">
                                    <label class="form-check-label" for="healthInsurance">Health Insurance</label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input benefit-checkbox" type="checkbox" id="dentalInsurance" value="Dental Insurance">
                                    <label class="form-check-label" for="dentalInsurance">Dental Insurance</label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input benefit-checkbox" type="checkbox" id="retirementPlan" value="Retirement Plan">
                                    <label class="form-check-label" for="retirementPlan">Retirement Plan</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check mb-2">
                                    <input class="form-check-input benefit-checkbox" type="checkbox" id="paidTimeOff" value="Paid Time Off">
                                    <label class="form-check-label" for="paidTimeOff">Paid Time Off</label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input benefit-checkbox" type="checkbox" id="remoteWork" value="Remote Work Options">
                                    <label class="form-check-label" for="remoteWork">Remote Work Options</label>
                                </div>
                                <div class="form-check mb-2">
                                    <input class="form-check-input benefit-checkbox" type="checkbox" id="flexibleHours" value="Flexible Hours">
                                    <label class="form-check-label" for="flexibleHours">Flexible Hours</label>
                                </div>
                            </div>
                        </div>
                        <input type="hidden" id="benefits" name="benefits">
                    </div>
                    
                    <div class="form-navigation">
                        <button type="button" class="btn btn-outline-secondary" id="prev3">
                            <i class="bi bi-arrow-left me-1"></i> Previous
                        </button>
                        <button type="button" class="btn btn-primary" id="next3">Next <i class="bi bi-arrow-right ms-1"></i></button>
                    </div>
                </div>

                <!-- Application Process -->
                <div class="form-section" id="section4">
                    <h3 class="section-title"><i class="bi bi-send"></i> Application Process</h3>
                    
                    <div class="mb-3">
                        <label for="applicationEmail" class="form-label">Application Email *</label>
                        <input type="email" class="form-control" id="applicationEmail" th:value="${owner.gmail}" readonly>
                        <input type="hidden" name="applicationEmail" th:value="${owner.gmail}">
                    </div>
                    
                    <div class="mb-3">
                        <label for="applicationDeadline" class="form-label">Application Deadline</label>
                        <input type="date" class="form-control" id="applicationDeadline" name="applicationDeadline">
                    </div>
                    
                    <div class="mb-3">
                        <label for="applicationInstructions" class="form-label">Application Instructions</label>
                        <textarea class="form-control" id="applicationInstructions" name="applicationInstructions" rows="3" placeholder="Any specific instructions for applicants..."></textarea>
                    </div>
                    
                    <div class="form-navigation">
                        <button type="button" class="btn btn-outline-secondary" id="prev4">
                            <i class="bi bi-arrow-left me-1"></i> Previous
                        </button>
                        <button type="button" class="btn btn-primary" id="next4">Next <i class="bi bi-arrow-right ms-1"></i></button>
                    </div>
                </div>

                <!-- Preview & Submit -->
                <div class="form-section" id="section5">
                    <h3 class="section-title"><i class="bi bi-eye"></i> Preview</h3>
                    
                    <div class="preview-card">
                        <div class="preview-title" id="previewJobTitle">Job Title</div>
                        <div class="preview-company" id="previewCompany" th:text="${owner.companyName}">Company Name</div>
                        
                        <div class="preview-details">
                            <div class="preview-detail">
                                <i class="bi bi-geo-alt"></i> <span id="previewLocation">Location</span>
                            </div>
                            <div class="preview-detail">
                                <i class="bi bi-clock"></i> <span id="previewJobType">Job Type</span>
                            </div>
                            <div class="preview-detail">
                                <i class="bi bi-tags"></i> <span id="previewCategory">Category</span>
                            </div>
                            <div class="preview-detail">
                                <i class="bi bi-cash"></i> <span id="previewSalary">Salary</span>
                            </div>
                            <div class="preview-detail">
                                <i class="bi bi-person"></i> <span id="previewExperience">Experience Level</span>
                            </div>
                        </div>
                        
                        <div class="preview-description" id="previewDescription">
                            Job description will appear here...
                        </div>
                        
                        <div class="mt-3" id="previewSkills">
                            <!-- Skills will appear here -->
                        </div>
                        
                        <div class="mt-3" id="previewBenefits">
                            <!-- Benefits will appear here -->
                        </div>
                    </div>
                    
                    <div class="form-navigation">
                        <button type="button" class="btn btn-outline-secondary" id="prev5">
                            <i class="bi bi-arrow-left me-1"></i> Previous
                        </button>
                        <div>
                            <button type="button" class="btn btn-outline-primary me-2" id="previewBtn">
                                <i class="bi bi-arrow-clockwise me-1"></i> Refresh Preview
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-send me-1"></i> Post Job
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Multi-step form navigation
            let currentStep = 1;
            const totalSteps = 5;
            
            // Navigation functions
            function showStep(step) {
                // Hide all sections
                document.querySelectorAll('.form-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                // Show current section
                document.getElementById(`section${step}`).classList.add('active');
                
                // Update progress indicator
                updateProgressIndicator(step);
                
                // Update preview if we're on the preview step
                if (step === 5) {
                    updatePreview();
                }
            }
            
            function updateProgressIndicator(step) {
                // Update step indicators
                document.querySelectorAll('.step').forEach((stepEl, index) => {
                    if (index + 1 < step) {
                        stepEl.classList.remove('active');
                        stepEl.classList.add('completed');
                    } else if (index + 1 === step) {
                        stepEl.classList.add('active');
                        stepEl.classList.remove('completed');
                    } else {
                        stepEl.classList.remove('active', 'completed');
                    }
                });
                
                // Update progress bar
                const progress = ((step - 1) / (totalSteps - 1)) * 100;
                document.getElementById('progressBar').style.width = `${progress}%`;
            }
            
            // Navigation event listeners
            document.getElementById('next1').addEventListener('click', function() {
                if (validateStep(1)) {
                    currentStep = 2;
                    showStep(currentStep);
                }
            });
            
            document.getElementById('next2').addEventListener('click', function() {
                // Validate skills
                const skills = requiredSkillsInput.value.trim();
                if (!skills) {
                    alert('Please add at least one required skill.');
                    skillInput.focus();
                    return;
                }
                
                currentStep = 3;
                showStep(currentStep);
            });
            
            document.getElementById('next3').addEventListener('click', function() {
                currentStep = 4;
                showStep(currentStep);
            });
            
            document.getElementById('next4').addEventListener('click', function() {
                currentStep = 5;
                showStep(currentStep);
            });
            
            // Previous buttons
            document.getElementById('prev2').addEventListener('click', function() {
                currentStep = 1;
                showStep(currentStep);
            });
            
            document.getElementById('prev3').addEventListener('click', function() {
                currentStep = 2;
                showStep(currentStep);
            });
            
            document.getElementById('prev4').addEventListener('click', function() {
                currentStep = 3;
                showStep(currentStep);
            });
            
            document.getElementById('prev5').addEventListener('click', function() {
                currentStep = 4;
                showStep(currentStep);
            });
            
            // Step validation
            function validateStep(step) {
                if (step === 1) {
                    const jobTitle = document.getElementById('jobTitle').value.trim();
                    const jobType = document.getElementById('jobType').value;
                    const location = document.getElementById('location').value.trim();
                    const jobDescription = document.getElementById('jobDescription').value.trim();
                    const categoryId = document.getElementById('categoryId').value; // Add category validation
                    
                    if (!jobTitle) {
                        alert('Please enter a job title.');
                        document.getElementById('jobTitle').focus();
                        return false;
                    }
                    
                    if (!jobType) {
                        alert('Please select a job type.');
                        document.getElementById('jobType').focus();
                        return false;
                    }
                    
                    if (!location) {
                        alert('Please enter a location.');
                        document.getElementById('location').focus();
                        return false;
                    }
                    
                    if (!jobDescription) {
                        alert('Please enter a job description.');
                        document.getElementById('jobDescription').focus();
                        return false;
                    }
                    
                    if (!categoryId) { // Validate category
                        alert('Please select a job category.');
                        document.getElementById('categoryId').focus();
                        return false;
                    }
                }
                
                return true;
            }
            
            // Skills functionality
            const skillInput = document.getElementById('skillInput');
            const skillsContainer = document.getElementById('skillsContainer');
            const previewSkills = document.getElementById('previewSkills');
            const requiredSkillsInput = document.getElementById('requiredSkills');
            
            skillInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const skill = skillInput.value.trim();
                    if (skill) {
                        addSkill(skill);
                        skillInput.value = '';
                    }
                }
            });
            
            function addSkill(skill) {
                // Create skill tag
                const skillElement = document.createElement('div');
                skillElement.className = 'skill-tag';
                skillElement.innerHTML = `
                    ${skill}
                    <button type="button" class="btn-close" onclick="removeSkill(this)"></button>
                `;
                skillsContainer.appendChild(skillElement);
                
                // Update hidden input and preview
                updateRequiredSkills();
                updatePreviewSkills();
            }
            
            function removeSkill(button) {
                button.parentElement.remove();
                updateRequiredSkills();
                updatePreviewSkills();
            }
            
            function updateRequiredSkills() {
                const skills = Array.from(skillsContainer.querySelectorAll('.skill-tag'))
                    .map(tag => tag.textContent.trim().replace('×', ''));
                requiredSkillsInput.value = skills.join(',');
                
                // Update validation state
                if (skills.length > 0) {
                    requiredSkillsInput.setCustomValidity('');
                } else {
                    requiredSkillsInput.setCustomValidity('Please add at least one skill');
                }
            }
            
            function updatePreviewSkills() {
                const skills = Array.from(skillsContainer.querySelectorAll('.skill-tag'))
                    .map(tag => tag.textContent.trim().replace('×', ''));
                
                previewSkills.innerHTML = '';
                if (skills.length > 0) {
                    const skillsTitle = document.createElement('div');
                    skillsTitle.className = 'fw-bold mb-2';
                    skillsTitle.textContent = 'Required Skills:';
                    previewSkills.appendChild(skillsTitle);
                    
                    skills.forEach(skill => {
                        const skillElement = document.createElement('span');
                        skillElement.className = 'tag';
                        skillElement.textContent = skill;
                        previewSkills.appendChild(skillElement);
                    });
                }
            }
            
            // Benefits functionality
            const benefitCheckboxes = document.querySelectorAll('.benefit-checkbox');
            const benefitsInput = document.getElementById('benefits');
            
            benefitCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', updateBenefits);
            });
            
            function updateBenefits() {
                const selectedBenefits = Array.from(benefitCheckboxes)
                    .filter(checkbox => checkbox.checked)
                    .map(checkbox => checkbox.value);
                benefitsInput.value = selectedBenefits.join(',');
                updatePreviewBenefits();
            }
            
            function updatePreviewBenefits() {
                const selectedBenefits = Array.from(benefitCheckboxes)
                    .filter(checkbox => checkbox.checked)
                    .map(checkbox => checkbox.value);
                
                const previewBenefits = document.getElementById('previewBenefits');
                previewBenefits.innerHTML = '';
                
                if (selectedBenefits.length > 0) {
                    const benefitsTitle = document.createElement('div');
                    benefitsTitle.className = 'fw-bold mb-2';
                    benefitsTitle.textContent = 'Benefits:';
                    previewBenefits.appendChild(benefitsTitle);
                    
                    selectedBenefits.forEach(benefit => {
                        const benefitElement = document.createElement('span');
                        benefitElement.className = 'tag';
                        benefitElement.textContent = benefit;
                        previewBenefits.appendChild(benefitElement);
                    });
                }
            }
            
            // Preview functionality
            document.getElementById('previewBtn').addEventListener('click', updatePreview);
            
            function updatePreview() {
                // Job details
                document.getElementById('previewJobTitle').textContent = 
                    document.getElementById('jobTitle').value || 'Job Title';
                document.getElementById('previewLocation').textContent = 
                    document.getElementById('location').value || 'Location';
                
                const jobTypeSelect = document.getElementById('jobType');
                const jobTypeText = jobTypeSelect.options[jobTypeSelect.selectedIndex]?.text || 'Job Type';
                document.getElementById('previewJobType').textContent = jobTypeText;
                
                // Category
                const categorySelect = document.getElementById('categoryId');
                const categoryText = categorySelect.options[categorySelect.selectedIndex]?.text || 'Not specified';
                document.getElementById('previewCategory').textContent = categoryText;
                
                // Experience level
                const experienceSelect = document.getElementById('experienceLevel');
                const experienceText = experienceSelect.options[experienceSelect.selectedIndex]?.text || 'Not specified';
                document.getElementById('previewExperience').textContent = experienceText;
                
                // Salary
                const minSalary = document.getElementById('salaryMin').value;
                const maxSalary = document.getElementById('salaryMax').value;
                let salaryText = 'Salary not specified';
                if (minSalary && maxSalary) {
                    salaryText = `MMK ${parseInt(minSalary).toLocaleString()} - MMK ${parseInt(maxSalary).toLocaleString()}`;
                } else if (minSalary) {
                    salaryText = `From MMK ${parseInt(minSalary).toLocaleString()}`;
                } else if (maxSalary) {
                    salaryText = `Up to MMK ${parseInt(maxSalary).toLocaleString()}`;
                }
                document.getElementById('previewSalary').textContent = salaryText;
                
                // Description (truncate if too long)
                const fullDescription = document.getElementById('jobDescription').value;
                const previewDescription = fullDescription.length > 300 ? 
                    fullDescription.substring(0, 300) + '...' : fullDescription;
                document.getElementById('previewDescription').textContent = 
                    previewDescription || 'Job description will appear here...';
                
                // Skills and Benefits
                updatePreviewSkills();
                updatePreviewBenefits();
            }
            
            // Form validation and submission
            document.getElementById('jobPostingForm').addEventListener('submit', function(e) {
                // Validate required skills
                const skills = requiredSkillsInput.value.trim();
                if (!skills) {
                    e.preventDefault();
                    alert('Please add at least one required skill.');
                    skillInput.focus();
                    return false;
                }
                
                // Validate other required fields
                const jobTitle = document.getElementById('jobTitle').value.trim();
                const jobType = document.getElementById('jobType').value;
                const location = document.getElementById('location').value.trim();
                const jobDescription = document.getElementById('jobDescription').value.trim();
                const categoryId = document.getElementById('categoryId').value; // Validate category
                
                if (!jobTitle) {
                    e.preventDefault();
                    alert('Please enter a job title.');
                    document.getElementById('jobTitle').focus();
                    return false;
                }
                
                if (!jobType) {
                    e.preventDefault();
                    alert('Please select a job type.');
                    document.getElementById('jobType').focus();
                    return false;
                }
                
                if (!location) {
                    e.preventDefault();
                    alert('Please enter a location.');
                    document.getElementById('location').focus();
                    return false;
                }
                
                if (!jobDescription) {
                    e.preventDefault();
                    alert('Please enter a job description.');
                    document.getElementById('jobDescription').focus();
                    return false;
                }
                
                if (!categoryId) { // Validate category
                    e.preventDefault();
                    alert('Please select a job category.');
                    document.getElementById('categoryId').focus();
                    return false;
                }
                
                // Validate salary range
                const minSalary = parseInt(document.getElementById('salaryMin').value) || 0;
                const maxSalary = parseInt(document.getElementById('salaryMax').value) || 0;
                if (minSalary > 0 && maxSalary > 0 && minSalary > maxSalary) {
                    e.preventDefault();
                    alert('Minimum salary cannot be greater than maximum salary.');
                    document.getElementById('salaryMin').focus();
                    return false;
                }
                
                // Show loading overlay
                document.getElementById('loadingOverlay').style.display = 'flex';
                
                // Allow form to submit normally
                return true;
            });
            
            // Save draft functionality
            document.getElementById('saveDraft').addEventListener('click', function() {
                // Save form data to localStorage
                const formData = {
                    jobTitle: document.getElementById('jobTitle').value,
                    jobType: document.getElementById('jobType').value,
                    categoryId: document.getElementById('categoryId').value, // Save category
                    department: document.getElementById('department').value,
                    location: document.getElementById('location').value,
                    jobDescription: document.getElementById('jobDescription').value,
                    companyWebsite: document.getElementById('companyWebsite').value,
                    experienceLevel: document.getElementById('experienceLevel').value,
                    educationLevel: document.getElementById('educationLevel').value,
                    salaryMin: document.getElementById('salaryMin').value,
                    salaryMax: document.getElementById('salaryMax').value,
                    applicationDeadline: document.getElementById('applicationDeadline').value,
                    applicationInstructions: document.getElementById('applicationInstructions').value,
                    requiredSkills: requiredSkillsInput.value,
                    benefits: benefitsInput.value
                };
                
                localStorage.setItem('jobDraft', JSON.stringify(formData));
                
                // Show success message
                const toast = new bootstrap.Toast(document.getElementById('successToast'));
                document.querySelector('#successToast .toast-body').textContent = 'Draft saved successfully!';
                toast.show();
            });
            
            // Load draft if exists
            const savedDraft = localStorage.getItem('jobDraft');
            if (savedDraft) {
                try {
                    const draft = JSON.parse(savedDraft);
                    
                    document.getElementById('jobTitle').value = draft.jobTitle || '';
                    document.getElementById('jobType').value = draft.jobType || '';
                    document.getElementById('categoryId').value = draft.categoryId || ''; // Load category
                    document.getElementById('department').value = draft.department || '';
                    document.getElementById('location').value = draft.location || '';
                    document.getElementById('jobDescription').value = draft.jobDescription || '';
                    document.getElementById('companyWebsite').value = draft.companyWebsite || '';
                    document.getElementById('experienceLevel').value = draft.experienceLevel || '';
                    document.getElementById('educationLevel').value = draft.educationLevel || '';
                    document.getElementById('salaryMin').value = draft.salaryMin || '';
                    document.getElementById('salaryMax').value = draft.salaryMax || '';
                    document.getElementById('applicationDeadline').value = draft.applicationDeadline || '';
                    document.getElementById('applicationInstructions').value = draft.applicationInstructions || '';
                    
                    // Load skills
                    if (draft.requiredSkills) {
                        const skills = draft.requiredSkills.split(',');
                        skills.forEach(skill => {
                            if (skill.trim()) {
                                addSkill(skill.trim());
                            }
                        });
                    }
                    
                    // Load benefits
                    if (draft.benefits) {
                        const benefits = draft.benefits.split(',');
                        benefitCheckboxes.forEach(checkbox => {
                            checkbox.checked = benefits.includes(checkbox.value);
                        });
                        updateBenefits();
                    }
                    
                    updatePreview();
                    
                    console.log('Draft loaded successfully');
                } catch (error) {
                    console.error('Error loading draft:', error);
                }
            }
            
            // Auto-update preview when form changes
            const formElements = document.querySelectorAll('#jobPostingForm input, #jobPostingForm select, #jobPostingForm textarea');
            formElements.forEach(element => {
                element.addEventListener('input', updatePreview);
                element.addEventListener('change', updatePreview);
            });
            
            // Initialize preview
            updatePreview();
            
            // Make removeSkill function globally available
            window.removeSkill = removeSkill;
        });
    </script>
</body>
</html>